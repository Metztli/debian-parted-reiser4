From a21d1dc4bd4d6f01ca11fd26a4ec24ccea9ed570 Mon Sep 17 00:00:00 2001
From: Colin Watson <cjwatson@ubuntu.com>
Date: Fri, 28 Mar 2014 17:10:15 +0000
Subject: Avoid assuming that gets is declared

Origin: backport, http://git.savannah.gnu.org/gitweb/?p=gnulib.git;a=commitdiff;h=66712c23388e93e5c518ebc8515140fa0c807348
Forwarded: no
Last-Update: 2012-11-06

Patch-Name: gnulib-gets.patch
---
 lib/stdio.in.h | 6 ++++--
 m4/stdio_h.m4  | 4 ++--
 2 files changed, 6 insertions(+), 4 deletions(-)

diff --git a/lib/stdio.in.h b/lib/stdio.in.h
index 79dda5f..6fb7681 100644
--- a/lib/stdio.in.h
+++ b/lib/stdio.in.h
@@ -140,10 +140,12 @@ _GL_WARN_ON_USE (fflush, "fflush is not always POSIX compliant - "
 #endif
 
 /* It is very rare that the developer ever has full control of stdin,
-   so any use of gets warrants an unconditional warning.  Assume it is
-   always declared, since it is required by C89.  */
+   so any use of gets warrants an unconditional warning; besides, C11
+   removed it.  */
 #undef gets
+#if HAVE_RAW_DECL_GETS
 _GL_WARN_ON_USE (gets, "gets is a security hole - use fgets instead");
+#endif
 
 #if @GNULIB_FOPEN@
 # if @REPLACE_FOPEN@
diff --git a/m4/stdio_h.m4 b/m4/stdio_h.m4
index f5650cd..d3edb42 100644
--- a/m4/stdio_h.m4
+++ b/m4/stdio_h.m4
@@ -35,9 +35,9 @@ AC_DEFUN([gl_STDIO_H],
 
   dnl Check for declarations of anything we want to poison if the
   dnl corresponding gnulib module is not in use, and which is not
-  dnl guaranteed by C89.
+  dnl guaranteed by both C89 and C11.
   gl_WARN_ON_USE_PREPARE([[#include <stdio.h>
-    ]], [dprintf fpurge fseeko ftello getdelim getline popen renameat
+    ]], [dprintf fpurge fseeko ftello getdelim getline gets popen renameat
     snprintf tmpfile vdprintf vsnprintf])
 ])
 
